{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch - Categories","object":{"parameters":{"job":[{"prototype":"run-incoming","parameters":{"incoming":"akeneo-fetch-categories"}}],"handlers":[],"priority":2,"expression":"*/5 * * * *"}},"description":"We need to get all categories from Akeneo system to ensure the parent children relation can be sent in the right order. To do so, we use an Incoming **\"Akeneo - Fetch - Categories\"** to get data from Akeneo Server.","owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"incoming-configuration","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch - Categories","object":{"parameters":{"entityType":"base-category","subscriber":{"prototype":"http-subscriber","parameters":{"client":"akeneo-http-client","request":{"uri":"/api/rest/v1/categories","payload":[],"plugins":[],"payloadType":"data","authentications":[]},"pagination":{"prototype":"next","parameters":{"pattern":"_links.next","pageLimit":10000}},"deserializer":{"prototype":"json","parameters":{"pattern":"_embedded.items","readMethod":"wholeFile","encodeInput":false}}}},"transformers":["akeneo-prepare-convert-category-labels-to-localizations","akeneo-convert-category-to-alumio-base","akeneo-filter-category"]}},"description":"Fetch all categories from Akeneo and create them into Alumio Task","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"akeneo-http-client","name":"Akeneo - HTTP Client","object":{"prototype":"akeneo-http-client-v2","parameters":{"key":"","baseUri":"${AKENEO_BASE_URL}","clientId":"${AKENEO_CLIENT_ID}","password":"${AKENEO_PASSWORD}","username":"${AKENEO_USERNAME}","clientSecret":"${AKENEO_CLIENT_SECRET}","enableLogging":true,"loggerFormatter":"full"}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"entity","identifier":"base-category","name":"Base - Category","object":{"parameters":{"schema":[],"identifierPath":["code"]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-prepare-convert-category-labels-to-localizations","name":"Akeneo - Prepare convert category - Labels - To localizations","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"accessor-move","parameters":{"source":{"prototype":"key","parameters":{"keys":[],"root":"labels"}},"destination":{"prototype":"structure","parameters":{"key":"localeCode","keys":[],"root":"localizations","value":"translation"}},"stripEnclosures":true}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"labels"}]}}]}},"description":"Preparing convert into Alumio Base Category by converting labels into array consist of localCode and localizations","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-convert-category-to-alumio-base","name":"Akeneo - Convert - Category - To Alumio Base","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"_links"},{"key":"updated"}]}}]}}]}},"description":"Convert Akeneo Category into Alumio Base Category","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-filter-category","name":"Akeneo - Filter - Category","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"type-setter","parameters":{"entityType":"base-category"}},{"meta":[],"prototype":"storage-filter-stored-entity","parameters":{"storage":"akeneo-filter-categories","addEntityToStorage":true}}]}},"description":"Filter Alumio Base Category which previously created into task  to avoid duplication","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"akeneo-filter-categories","name":"Akeneo - Filter - Categories","object":{"parameters":{"path":"akeneo-filter-categories-01K2PMG294PHVEVJ8YJBWCPXPR","logger":{"parameters":{"actions":[]}}}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"magento-2-send-categories","name":"Magento 2 - Send - Categories","object":{"parameters":{"job":[{"prototype":"run-outgoing","parameters":{"route":"synchronize-categories-from-akeneo-into-magento","numTasks":100}}],"handlers":[],"priority":2,"expression":"*/5 * * * *"}},"description":"This scheduler will process the task created from the Incoming.","owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"route-configuration","identifier":"synchronize-categories-from-akeneo-into-magento","name":"Synchronize Categories - From Akeneo into Magento 2","object":{"parameters":{"incoming":"akeneo-fetch-categories","outgoing":"magento-2-send-category","realtime":false,"transformers":[],"waitingStatus":false,"parallelExecution":[]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"outgoing-configuration","identifier":"magento-2-send-category","name":"Magento 2 - Send - Category","object":{"parameters":{"publisher":{"prototype":"no-action-publisher","parameters":[]},"transformers":["magento-2-prepare-convert-category-parent-from-alumio-base-category","magento-2-convert-category-from-alumio-base-category","magento-2-check-and-send-category"]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"magento-2-prepare-convert-category-parent-from-alumio-base-category","name":"Magento 2 - Prepare convert - Category - Parent from Alumio Base Category","object":{"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-exists-condition","parameters":{"path":"parent"}}}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"parent"}},"conditions":[{"prototype":"not-equals","parameters":{"value":null}},{"prototype":"not-equals","parameters":{"value":[]}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"magento-2-category-akeneo-code-to-id","storageKey":"&{parent}","destination":"parent_id"}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-not-exists-condition","parameters":{"path":"parent_id"}}}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"exception","parameters":{"message":"Category id not found for parent"}}],"elseTransformers":[]}}],"elseTransformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"parent"}]}}]}}],"elseTransformers":[]}}]}},"description":"This transformer will check the parent and map into Magento 2 Category id.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"magento-2-category-akeneo-code-to-id","name":"Magento 2 - Category - Akeneo code to id","object":{"parameters":{"path":"magento-2-category-akeneo-code-to-id-01K2PMG2HMG976PVH2WVMTXZ32","logger":{"parameters":{"actions":[]}}}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"magento-2-convert-category-from-alumio-base-category","name":"Magento 2 - Convert - Category - from Alumio Base Category","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"category","value":{"name":"&{(localizations[?localeCode=='en_US'].translation | [0]) || (localizations[?localeCode=='en_GB'].translation | [0]) || (localizations[].translation | [0])}","position":"1","is_active":true,"include_in_menu":true},"mappers":[]}]}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"and-condition","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-exists-condition","parameters":{"path":"parent_id"}}}},{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"parent_id"}},"conditions":[{"prototype":"not-equals","parameters":{"value":null}},{"prototype":"not-equals","parameters":{"value":[]}}]}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"pattern-copy","parameters":{"pattern":"parent_id","conditions":[],"replacement":"category.parent_id"}}],"elseTransformers":[]}}]}}]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"magento-2-check-and-send-category","name":"Magento 2 - Check and send - Category","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"magento-2-category-akeneo-code-to-id","storageKey":"&{code}","destination":"category.id"}},{"meta":[],"prototype":"merger","parameters":{"template":{"result":"&{@}"},"transformer":{"meta":[],"prototype":"http-transformer","parameters":{"client":"magento-2-http-client","request":{"uri":"/rest/${MAGENTO_STORE}/V1/categories","method":"POST","payload":{"category":"&{category}"},"plugins":[],"payloadType":"data","authentications":[]}}}}},{"meta":[],"prototype":"storage-save-entity-in-storage","parameters":{"source":"result.id","storage":"magento-2-category-akeneo-code-to-id","storageKey":"&{code}"}}]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"magento-2-http-client","name":"Magento 2 - HTTP Client","object":{"parameters":{"ssl":{"ssl_enable_npn":true,"ssl_verifyhost":true,"ssl_verifypeer":true,"ssl_enable_alpn":true},"proxy":[],"plugins":[{"prototype":"base-uri","parameters":{"uri":{"parameters":"${MAGENTO_BASE_URL}"},"config":[]}},{"prototype":"logger","parameters":{"formatter":"full"}},{"prototype":"header-append","parameters":{"headers":{"Accept":"application/json","Content-Type":"application/json"}}}],"httpauth":[],"connection":[],"development":{"resolve":[],"connect_to":[]},"authentications":[{"prototype":"magento-2-integration-oauth1","parameters":{"signature":{"prototype":"oauth1-hmac-sha256","parameters":[]},"accessToken":"${MAGENTO_ACCESS_TOKEN}","consumerKey":"${MAGENTO_CONSUMER_KEY}","consumerSecret":"${MAGENTO_CONSUMER_SECRET}","accessTokenSecret":"${MAGENTO_ACCESS_TOKEN_SECRET}"}}],"enableErrorHandling":true,"errorHttpCodeRanges":[{"to":500,"from":400},{"to":600,"from":500}]}},"description":"","owner":null,"disabled":false}